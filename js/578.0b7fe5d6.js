"use strict";(self["webpackChunkmy_taobao"]=self["webpackChunkmy_taobao"]||[]).push([[578],{1578:function(t,e,o){o.r(e),o.d(e,{default:function(){return C}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"login"},[e("van-nav-bar",{attrs:{title:"会员登录","left-arrow":""},on:{"click-left":function(e){return t.$router.go(-1)}}}),e("div",{staticClass:"container"},[t._m(0),e("div",{staticClass:"form"},[e("div",{staticClass:"form-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.mobile,expression:"mobile"}],staticClass:"inp",attrs:{maxlength:"12",placeholder:"请输入手机号码",type:"text"},domProps:{value:t.mobile},on:{input:function(e){e.target.composing||(t.mobile=e.target.value)}}})]),e("div",{staticClass:"form-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.imgCode,expression:"imgCode"}],staticClass:"inp",attrs:{maxlength:"5",placeholder:"请输入图形验证码",type:"text"},domProps:{value:t.imgCode},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.getSMSCode.apply(null,arguments)},input:function(e){e.target.composing||(t.imgCode=e.target.value)}}}),t.imgUrl?e("img",{attrs:{alt:"",src:t.imgUrl},on:{click:t.getImgCode}}):t._e()]),e("div",{staticClass:"form-item"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.smsCode,expression:"smsCode"}],staticClass:"inp",attrs:{placeholder:"请输入短信验证码",type:"text"},domProps:{value:t.smsCode},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.login.apply(null,arguments)},input:function(e){e.target.composing||(t.smsCode=e.target.value)}}}),e("button",{style:t.sendCoolDown!==t.totalSendCoolDown&&"color: grey;",attrs:{disabled:t.sendCoolDown!==t.totalSendCoolDown},on:{click:t.getSMSCode}},[t._v(t._s(t.sendCoolDown===t.totalSendCoolDown?"获取验证码":t.sendCoolDown+"秒后重新发送"))])])]),e("div",{staticClass:"login-btn",on:{click:t.login}},[t._v("登录/注册")])])],1)},i=[function(){var t=this,e=t._self._c;return e("div",{staticClass:"title"},[e("h3",[t._v("手机号登录")]),e("p",[t._v("未注册的手机号登录后将自动注册")])])}],n=o(5720);const a=()=>n.A.get("/captcha/image"),l=(t,e,o)=>n.A.post("/captcha/sendSmsCaptcha",{form:{captchaCode:t,captchaKey:e,mobile:o}}),r=(t,e)=>n.A.post("/passport/login",{form:{isParty:!1,partyData:{},mobile:t,smsCode:e}},{headers:{Platform:"H5"}});var d={name:"LoginIndex",data(){return{imgCode:"",imgKey:"",imgUrl:"",totalSendCoolDown:60,sendCoolDown:60,sendTimer:null,mobile:"",smsCode:""}},async created(){this.getImgCode()},methods:{async getImgCode(){const{data:{base64:t,key:e}}=await a();this.imgUrl=t,this.imgKey=e},async getSMSCode(){this.verifyInput()&&(this.sendTimer||this.sendCoolDown!==this.totalSendCoolDown||(await l(this.imgCode,this.imgKey,this.mobile),this.sendTimer=setInterval((()=>{this.sendCoolDown--,this.sendCoolDown<=0&&(clearInterval(this.sendTimer),this.sendTimer=null,this.sendCoolDown=this.totalSendCoolDown)}),1e3)))},verifyInput(){return/^((\+\d{1,2}\s)?\(?\d{3}\)?[\s.-]?\d{3}[\s.-]?\d{4}|(\+?0?86-?)?(13[0-9]|14[579]|15[0-3,5-9]|16[6]|17[0135678]|18[0-9]|19[89])\d{8})$/.test(this.mobile)?!!/^\w{4}$/.test(this.imgCode)||(this.$toast.fail("请输入正确的图形验证码"),!1):(this.$toast.fail("请输入正确的手机号码"),!1)},async login(){if(!this.verifyInput())return;if(/^\d{6}$/.test(this.sms))return void this.$toast("请输入正确的短信验证码");const{data:t}=await r(this.mobile,this.smsCode);console.log(t),this.$store.commit("user/SET_USER_INFO",t),this.$toast("登录成功");const e=this.$route.query.backUrl||"/";this.$router.replace(e)}},beforeDestroy(){clearInterval(this.sendTimer)}},m=d,c=o(1656),u=(0,c.A)(m,s,i,!1,null,"63488987",null),C=u.exports}}]);
//# sourceMappingURL=578.0b7fe5d6.js.map